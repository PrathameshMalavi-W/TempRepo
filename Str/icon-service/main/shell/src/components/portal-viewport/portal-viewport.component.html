<div *ngIf="!globalErrMsg; else globalError" class="onecx-viewport-wrapper">
  <ng-container *ngIf="themeService.currentTheme$ | async; else noTheme">
    <!-- Header slot group -->
    <header class="onecx-header" id="ocx_header">
      <section [ngStyle]="{width: '100%'}" [attr.aria-label]="'Start'">
        <ocx-shell-slot-group
          name="onecx-shell-header"
          direction="row"
          [slotInputs]="slotHeaderInputs"
          [slotOutputs]="slotHeaderOutputs"
        ></ocx-shell-slot-group>
      </section>
    </header>

    <!-- SubHeader slot group -->
    <ocx-shell-slot-group class="onecx-subheader" name="onecx-shell-sub-header"></ocx-shell-slot-group>
    <div class="onecx-body-wrapper">
      <!-- BodyStart slot group -->
      <ocx-shell-slot-group
        class="onecx-body-start"
        name="onecx-shell-body-start"
        direction="column"
      ></ocx-shell-slot-group>
      <div class="onecx-body-center">
        <!-- BodyHeader slot group -->
        <ocx-shell-slot-group class="onecx-body-header" name="onecx-shell-body-header"></ocx-shell-slot-group>
        <div class="onecx-body">
          <ng-container *ngIf="!routesService || (routesService.showContent$ | async); else appLoading">
            <ng-content></ng-content>
            <router-outlet></router-outlet>
          </ng-container>
        </div>
        <!-- BodyFooter slot group -->
        <ocx-shell-slot-group class="onecx-body-footer" name="onecx-shell-body-footer"></ocx-shell-slot-group>
      </div>
      <!-- BodyEnd slot group -->
      <ocx-shell-slot-group
        class="onecx-body-end"
        name="onecx-shell-body-end"
        direction="column"
      ></ocx-shell-slot-group>
    </div>

    <!-- Footer slot group -->
    <footer>
      <ocx-shell-slot-group name="onecx-shell-footer"></ocx-shell-slot-group>
    </footer>
  </ng-container>
</div>

<ng-template #noTheme>
  <div class="onecx-no-theme-main">
    <div class="onecx-no-theme-content relative">
      <ng-content></ng-content>
      <router-outlet></router-outlet>
    </div>
  </div>
</ng-template>

<ng-template #globalError>
  <ocx-shell-error [errCode]="globalErrMsg"></ocx-shell-error>
</ng-template>

<ng-template #appLoading>
  <ocx-shell-loading-spinner></ocx-shell-loading-spinner>
</ng-template>

<!-- Extensions slot for adding custom functionality -->
<ocx-slot class="extensions-slot" name="onecx-shell-extensions"></ocx-slot>

<!-- DEBUG: Icon Status Display (Portal Viewport) -->
<div class="absolute bottom-4 right-4 bg-gray-900 text-white p-4 rounded max-h-80 overflow-y-auto text-xs font-mono z-50">
  <div class="font-bold mb-2 text-blue-400">Portal Icons Status</div>
  <div *ngIf="iconStatuses.length === 0" class="text-gray-400">Waiting for icons...</div>
  <div *ngFor="let status of iconStatuses" class="mb-2 pb-2 border-b border-gray-700">
    <div class="font-semibold">{{ status.name }}</div>
    <div class="text-gray-300">Type: <span class="text-blue-300">{{ status.classType }}</span></div>
    <div class="text-gray-300">CSS: <span class="text-green-300 break-all">{{ status.cssClass || 'N/A' }}</span></div>
    <div class="text-gray-300">Async: <span [class]="status.asyncResult ? 'text-green-300' : 'text-red-300'\">{{ status.asyncResult ? '✓ Found' : '✗ Not found' }}</span></div>
  </div>
</div>
